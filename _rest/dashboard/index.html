<!DOCTYPE html>
<html>
<head>
  <title>dashboard demo</title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>

  <script type="text/javascript" src="https://localhost:5001/js/dashboard?recompile=1"></script>
  <script type="text/javascript">
    window.Socket.subscribe(window.Socket.events.ADMIN_DISCONNECTED, onClientDisconnected);
    window.Socket.subscribe(window.Socket.events.ADMIN_CONNECTED, onClientConnected);
    window.Socket.subscribe(window.Socket.events.ACTION_INSERT, onActionInsert);
    window.Socket.subscribe(window.Socket.events.ACTION_UPDATE, onActionUpdate);

    function onClientDisconnected(e){
      console.warn('Inside the my method onClientDisconnected', e);
    }
    function onClientConnected(e){
      console.warn('Inside the my method onClientConnected', e);
    }

    function onActionInsert(e){
      console.warn('on action insert', e);
    }
    function onActionUpdate(e){
      console.warn('on action update', e);
    }


    var tk = '';
    function login(){
      $.ajax({
        url:'https://localhost:5001/api/login/ako/akopass0', 
        method:'GET',
        success:function(r){
          tk = r.accessToken;
          console.log(r);
        }
      })
    }

    function action(){
      $.ajax({
        url:'https://localhost:5001/api/actions?Limit=200', 
        method:'GET',
        headers: {
          'authentication':tk
        },
        success:function(r){
          console.log(r);
        }
      })
    }

    function testDirect(){
      var q = new Query();
      q.select('actionid, trackingid, created').from('tm_action').limit(1000);
      window.Direct.load(q, function(data){
        console.log(data);
      });
    }

    function testQueryDirect(val){
      if(typeof val === 'undefined')
        val = 'SELECT msisdn, email FROM [].tm_lead WHERE email IS NOT NULL';
      var q = new Query();
      q.sql(val);
      window.Direct.load(q, function(data){
        console.log(data);
      });
    }
    
  </script>

</body>
</html>