<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<style type="text/css">
  .initialSpan{color:blue;}
</style>

</head>
<body>

  <div>
    <div>Message: <span class="initialSpan" id="regMessage"></span></div>
    <div>Lead: <span class="initialSpan" id="regLead"></span></div>
    <div>Country: <span class="initialSpan" id="regSessionData"></span></div>
    <div>leadHasSubscription: <span class="initialSpan" id="leadHasSubscription"></span></div>
  </div>

  <div style="margin-top: 15px;" id="infoEmail">
    <div>Insert email</div>
    <div>
      <input type="text" id="inputEmail"/>
    </div>
    <button id="insertEmail">Execute</button>
  </div>


  <div style="margin-top: 15px; display: none;" id="infoBlock">
    <div>Informations</div>
    <div>
      <label>First name: </label> <input type="text" id="inputFirstName"/> <br>
      <label>Last name: </label> <input type="text" id="inputLastName"/> <br>
      <label>Address: </label> <input type="text" id="inputAddress"/> <br>
      <label>City: </label> <input type="text" id="inputCity"/> <br>
      <label>Postcode: </label> <input type="text" id="inputPostcode"/> <br>
      <label>Msisdn: </label> <input type="text" id="inputMsisdn"/> <br>
      <label>Country: </label> 
      <select id="inputCountry" class="form-control" name="country-select" required="required"><option value="0" disabled="" selected="" translation="countryValue" hidden="">Select Country</option><option value="australia">Australia</option><option value="united kingdom">United Kingdom</option><option value="canada">Canada</option><option value="france">France</option><option value="germany">Germany</option><option value="norway">Norway</option><option value="italy">Italy</option><option value="belgium">Belgium</option><option value="new zealand">New Zealand</option></select>
      <br>
    </div>
    <button id="insertinfo">Execute</button>
  </div>


  <div style="margin-top: 15px; display: none;" id="infoFinal">
    <strong>SRBIJA!!!</strong>
  </div>

  <script type="text/javascript">
    var CC=Object;CC.type='lp';CC.lander={createUserModel:{email:'' },createUser:function(callback){CC.api.send('user-create',this.createUserModel,callback); },subscribeUserModel:{firstName:'',lastName:'',address:'',city:'',postcode:'',msisdn:'',country:''},subscribeUser:function(callback){CC.api.send('user-subscribe',this.subscribeUserModel,callback); },userRedirectedModel:{url:'' },userRedirected:function(callback){CC.api.send('user-redirected',this.userRedirectedModel,callback); }};CC.host='';CC.dbg=false;CC.type='lp';CC.api={callbacks:[],socket:null,onopen:null,onclose:null,onmessage:null,onerror:null,created:null,init:function(registration_callback,providerID){if(CC.host==''){console.error('host is not defined!!');return;}if(this.checkCallback(registration_callback)){console.error('registration_callback missing or misformed!!concentrate!');return;}var self=this;self.created=new Date();var registered=false;this.socket=new WebSocket(CC.host+'/ws_api?type='+CC.type);this.socket.onopen=e=>{self.console('onopen',e);if(!registered){self.send('register',{url:document.location.href,providerID:(typeof providerID==='undefined'?null:providerID) },registration_callback);registered=true;}if(typeof self.onopen==='function') self.onopen(e);};this.socket.onclose=function(e){if(typeof self.onclose==='function') self.onclose(e);registration_callback.error(e);self.console('onclose',e);};this.socket.onmessage=function(e){if(typeof self.onmessage==='function') self.onmessage(e);var response=JSON.parse(e.data);var milisecondsPassed=0;for(var i=0; i < self.callbacks.length; i++)if(self.callbacks[i].Key===response.key){if(response.Status){self.callbacks[i].success(response.Data,response.Message);}else{self.callbacks[i].error(response.Data,response.Message);}milisecondsPassed=((new Date()).getTime()-self.callbacks[i].created.getTime());self.callbacks.splice(i,1);break;}if(response.Key==='reg-post'){milisecondsPassed=((new Date()).getTime()-self.created.getTime());}self.console(`We got response in ${milisecondsPassed} miliseconds for #${response.Key}!`,response);};this.socket.onerror=function(e){if(typeof self.onerror==='function') self.onerror(e);registration_callback.error(e);self.console('onerror',e);};},send:function(key,data,callback){if(typeof callback!=='undefined'&&this.checkCallback(callback)){this.console("error with callback. callback must be object with 'success' and 'error' functions!!!!");return;}callback.created=new Date();callback.key=key;this.callbacks.push(callback);this.console('sendingData',{key:key,data:data });this.socket.send(key+'#'+JSON.stringify(data));},checkCallback:function(callback){if(typeof callback!=="object"||typeof callback.success!=="function"||typeof callback.error!=="function")return true;return false;},console:function(data,obj){if(!CC.dbg) return;console.warn('ccsocket::'+data,obj);}};
  </script>
  <script type="text/javascript">
    
    document.addEventListener('DOMContentLoaded', function(){
        if(typeof CC === 'undefined'){
          alert('no CC wtf??');
          return;
        }

        CC.host = 'wss://localhost:5001';
        CC.dbg = true;
        CC.api.init( {
          success:function(e, msg){
            console.log('init success', msg, e);
            $('#regMessage').text(msg);
            $('#regLead').text(JSON.stringify(e.lead));
            $('#regSessionData').text(JSON.stringify(e.country));
            $('#leadHasSubscription').text(e.leadHasSubscription);
          },
          error: function(e){
            // REDIRECTION LOCGIC OR SOMETHING (SERVER IS DOWN or connection is unstable)
            alert('lost connection or something went wrong!');
          }
        }, 1);

        ///
        /// INSERT EMAIL
        ///

        // sve funkcije trebaju biti dostupne samo ako init prodje kako treba!!
        $('#insertEmail').click(function(){
          CC.lander.createUserModel.email = $('#inputEmail').val();
          // check data!!!
          CC.lander.createUser({
            success:function(e){
              $('#infoEmail').hide();
              $('#infoBlock').show();
            },
            error: function(e){
              if(e.emptyEmail) alert('Mail is empty');
              if(e.refused) alert('Mail is refused!!');
            }
          });
        });


        ///
        /// INSERT CONTACTS
        ///

        $('#insertinfo').click(function(){

          CC.lander.subscribeUserModel.firstName = $('#inputFirstName').val();
          CC.lander.subscribeUserModel.lastName = $('#inputLastName').val();
          CC.lander.subscribeUserModel.address = $('#inputAddress').val();
          CC.lander.subscribeUserModel.city = $('#inputCity').val();
          CC.lander.subscribeUserModel.postcode = $('#inputPostcode').val();
          CC.lander.subscribeUserModel.msisdn = $('#inputMsisdn').val();
          CC.lander.subscribeUserModel.country = $('#inputCountry option:selected').val();

          // check data !!!

          CC.lander.subscribeUser({
            success:function(e){
              $('#infoBlock').hide();
              finalStep();
            },
            error: function(e){
              if(e.emptyEmail) alert('Mail is empty');
              if(e.refused) alert('Mail is refused!!');
            }
          });

        ///
        /// FINAL STEP
        ///

          function finalStep(){
            CC.lander.userRedirectedModel.url = 'https://google.com';
            CC.lander.userRedirected({
              success:function(e){ 
                alert('yeas'); 
                $('#infoFinal').show(); 
              },
              error: function(){}
            });
          }

        });

      }, false);
  </script>
</body>
</html>